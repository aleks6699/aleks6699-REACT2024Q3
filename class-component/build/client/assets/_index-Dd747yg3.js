import{j as e,r as g,v as N,w as k,x as C,y as I,z as F,O as L,B as $,C as T,G as U,H as D,I as E}from"./store-CdRNTWRs.js";import{a as V}from"./context-Ceb_irxG.js";function R({value:a,onInput:t}){return e.jsx("input",{className:"input-search",type:"text",placeholder:"Search",value:a,onInput:t})}function B({onClick:a}){return e.jsx("button",{className:"button",type:"button",onClick:a,children:"Search"})}function f(){const a=g.useContext(V);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a}function G(){const{theme:a,toggleTheme:t}=f();return e.jsxs("button",{className:"toggle",children:[e.jsx("input",{className:"btn",type:"checkbox",id:"btn",onChange:t,checked:a}),e.jsx("label",{htmlFor:"btn",children:e.jsx("span",{"data-testid":"thumb",className:"thumb"})})]})}function H({inputValue:a,onInput:t,onClick:c}){const{theme:n}=f();return e.jsxs("div",{id:"header",className:`header ${n?"light":"dark"}`,children:[e.jsxs("div",{className:"inner-search",children:[e.jsx(R,{value:a,onInput:t}),e.jsx(B,{onClick:c})]}),e.jsx(G,{})]})}function M({pages:a,clickPagination:t,activePage:c}){const n=parseInt(a,10),s=[];for(let o=0;o<n;o++)s.push(e.jsx("button",{className:`page-button ${c===(o+1).toString()?"active":""}`,onClick:u=>t&&t(u),children:o+1},o));return e.jsx(e.Fragment,{children:n===0?e.jsx(e.Fragment,{}):e.jsx("div",{className:"pagination",children:s})})}function P(a){if(!a)return null;const t=a.match(/\d+\/$/);return t?t[0].replace("/",""):null}function _(a,t){const c=new URLSearchParams(window.location.search);c.set(t,a);const n=`${window.location.pathname}?${c.toString()}`;window.history.replaceState({},"",n)}function A(a){const t=new URLSearchParams(window.location.search);t.delete(a);const c=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",c)}const O=({onCange:a,checked:t})=>e.jsx("div",{className:"wrapper-checkbox",children:e.jsxs("label",{className:"textLabel",children:["Selected card",e.jsx("input",{type:"checkbox",className:"magicCheckbox",onChange:a,checked:t})]})});function Q(a){const t=["Name","URL","Skin","Eye","Gender","Mass","Height"],c=a.map(s=>[s.name,s.url,s.skin_color,s.eye_color,s.gender,s.mass,s.height]),n="data:text/csv;charset=utf-8,"+[t.join(";"),...c.map(s=>s.join(";"))].join(`
`);return encodeURI(n)}function z(){const a=N(),t=k(n=>n.favoritesList.favoritesList);function c(){return t.length>0}return e.jsxs("div",{className:`flyout ${c()?"":"flyout-hidden"}`,children:[e.jsxs("div",{className:"selected",children:["Selected items: ",t.length]}),e.jsxs("div",{className:"inner-flyout",children:[e.jsx("button",{className:"flyout-clear",type:"button",onClick:()=>a(C()),children:"Unselect all"}),e.jsx("a",{className:"flyout-download",href:Q(t),download:`starwars_${t.length}.csv`,children:"Download"})]})]})}const q="/loading.gif";function y(){return e.jsx("div",{className:"loading",children:e.jsx("img",{src:q,alt:"loading"})})}function J({results:a,clickPagination:t,activePage:c}){const[n,s]=g.useState(null),{theme:o}=f(),{data:u,isFetching:d}=I(n,{skip:!n}),h=N(),x=k(r=>r.favoritesList.favoritesList);function j(r){return r?x.some(i=>i.url!==void 0&&P(i.url)===r):!1}h(F(u));const v=Math.ceil(a.count/10).toString();function w(r,i){r.stopPropagation(),r.target.checked?h($(i)):h(T(i.name))}function S(r){const i=r.target;if(i.tagName==="INPUT"&&i.type==="checkbox")return;const p=r.currentTarget.getAttribute("data-id");p&&(s(p),_(p,"details"))}function l(r){r.stopPropagation(),A("details")}return e.jsxs("main",{className:`main ${o?"light":"dark"}`,children:[e.jsxs("div",{className:"wrapper-main",children:[e.jsx("div",{className:"results",onClick:l,"aria-hidden":"true",role:"button",tabIndex:0,children:a.results.map((r,i)=>{const m=r.url?P(r.url):null;if(!m)return null;const p=j(m);return e.jsxs("div",{className:"result-item","data-id":m,onClick:b=>S(b),"aria-hidden":"true",role:"button",tabIndex:0,children:[e.jsx("img",{src:`https://starwars-visualguide.com/assets/img/characters/${m}.jpg`,alt:r.name}),e.jsx("h2",{children:r.name}),e.jsx(O,{onCange:b=>w(b,r),checked:p})]},i)})}),d?e.jsx(y,{}):n&&u?e.jsx(L,{context:{personDetails:u,selectedPersonId:n}}):null]}),e.jsx(M,{pages:v,clickPagination:t,activePage:c}),e.jsx(z,{})]})}const K=(a,t,c,n)=>{g.useEffect(()=>{localStorage.setItem("inputValue",t||"");const s=localStorage.getItem("inputValue");c(s||"");const o=new URLSearchParams;return o.set("search",s||""),o.set("page",a||"1"),n(o),()=>{localStorage.setItem("inputValue",t||"")}},[a])};function W(){const{theme:a}=f(),[t,c]=g.useState(""),[n,s]=U({search:"",page:"1"}),o=n.get("page")||"1",u=n.get("search")||"",{data:d,isFetching:h}=D({searchTerm:u,currentPage:o});console.log(d),K(o,u,c,s);const x=N(),j=k(l=>l.people.people);g.useEffect(()=>{d&&x(E(d))},[d,x]);const v=l=>{l.preventDefault(),c(l.target.value.trim())},w=()=>{s({search:t,page:"1"})},S=l=>{l.preventDefault();const r=l.currentTarget.textContent??"1";s({search:t,page:r})};return e.jsxs("div",{className:`wrapper ${a?"light":"dark"}`,children:[e.jsx(H,{inputValue:t,onInput:v,onClick:w}),h&&e.jsx(y,{}),e.jsx(J,{results:j,activePage:o,clickPagination:S})]})}function Z(){return e.jsx(W,{})}export{Z as default};
